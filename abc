import { Component } from '@angular/core';

@Component({
  selector: 'app-discrepancy-review',
  templateUrl: './discrepancy-review.component.html',
  styleUrls: ['./discrepancy-review.component.css']
})
export class DiscrepancyReviewComponent {
  foFileName = '';
  boFileName = '';
  foColumns: string[] = [];
  boColumns: string[] = [];
  selectedFoColumn = '';
  selectedBoColumn = '';

  discrepancies: {
    foFile: string;
    boFile: string;
    foColumn: string;
    boColumn: string;
    discrepancyCount: number;
    comment: string;
  }[] = [];

  handleFoUpload(event: any) {
    const file = event.target.files[0];
    if (file) {
      this.foFileName = file.name;
      this.extractColumns(file, 'fo');
    }
  }

  handleBoUpload(event: any) {
    const file = event.target.files[0];
    if (file) {
      this.boFileName = file.name;
      this.extractColumns(file, 'bo');
    }
  }

  extractColumns(file: File, type: 'fo' | 'bo') {
    const reader = new FileReader();
    reader.onload = () => {
      const text = reader.result as string;
      const lines = text.split(/\r?\n/);
      const header = lines[0];
      const columns = header.split(',').map(col => col.trim());
      if (type === 'fo') {
        this.foColumns = columns;
      } else {
        this.boColumns = columns;
      }
    };
    reader.readAsText(file);
  }

  checkDiscrepancies() {
    if (this.selectedFoColumn && this.selectedBoColumn) {
      this.discrepancies = [
        {
          foFile: this.foFileName,
          boFile: this.boFileName,
          foColumn: this.selectedFoColumn,
          boColumn: this.selectedBoColumn,
          discrepancyCount: Math.floor(Math.random() * 10),
          comment: ''
        }
      ];
    }
  }
}