<!DOCTYPE html>
<div class="container">
    <!-- File Upload Sections -->
    <div class="upload-section">
        <div class="box" *ngFor="let source of [1,2]; let i = index">
            <div class="file">
                <p>Source {{i+1}}</p>
                <label class="upload-label">
                    <input type="file" class="upload-input" 
                           (change)="onFileUpload($event, i+1)">
                    <span class="upload-placeholder">
                        <span class="pi pi-file-excel"></span>
                        Choose File
                    </span>
                    <span *ngIf="filenames[i]" class="upload-filename">
                        {{filenames[i]}}
                    </span>
                </label>
            </div>
        </div>
    </div>

    <!-- Columns Selection with Drag & Drop -->
    <div class="columns-container">
        <!-- Source 1 Columns -->
        <div class="columns-list" *ngIf="file1Columns?.length">
            <h4>Columns from Source 1:</h4>
            <div class="draggable-column" 
                 *ngFor="let col of file1Columns" 
                 draggable="true"
                 (dragstart)="onDragStart($event, col, 1)">
                {{col}}
            </div>
        </div>

        <!-- Source 2 Columns -->
        <div class="columns-list" *ngIf="file2Columns?.length">
            <h4>Columns from Source 2:</h4>
            <div class="draggable-column" 
                 *ngFor="let col of file2Columns" 
                 draggable="true"
                 (dragstart)="onDragStart($event, col, 2)">
                {{col}}
            </div>
        </div>

        <!-- Drop Zones -->
        <div class="drop-zones">
            <div class="drop-zone" 
                 (dragover)="onDragOver($event)" 
                 (drop)="onDrop($event, 1)">
                <h4>Drop Source 1 Column Here</h4>
                <div *ngFor="let col of selectedColumns1" class="selected-column">
                    {{col}}
                </div>
            </div>

            <div class="drop-zone" 
                 (dragover)="onDragOver($event)" 
                 (drop)="onDrop($event, 2)">
                <h4>Drop Source 2 Column Here</h4>
                <div *ngFor="let col of selectedColumns2" class="selected-column">
                    {{col}}
                </div>
            </div>
        </div>
    </div>

    <!-- Compare Button -->
    <button class="compare-btn" (click)="compareColumns()">Compare</button>

    <!-- Results Display -->
    <div class="results-section">
        <div class="count-summary">
            <p>Total Matched: <span class="matched">{{matchedCount}}</span></p>
            <p>Total Mismatched: <span class="mismatched">{{mismatchedCount}}</span></p>
        </div>

        <p-table [value]="combinedData" [paginator]="true" [rows]="10">
            <ng-template pTemplate="header">
                <tr>
                    <th>{{selectedColumns1[0] || 'Source 1 Column'}}</th>
                    <th>{{selectedColumns2[0] || 'Source 2 Column'}}</th>
                    <th>Status</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-row>
                <tr>
                    <td>{{row.source1Value}}</td>
                    <td>{{row.source2Value}}</td>
                    <td>
                        <span [style.color]="row.match ? 'green' : 'red'">
                            {{row.match ? 'MATCH' : 'MISMATCH'}}
                        </span>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>